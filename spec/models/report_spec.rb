require 'spec_helper'


describe 'Report' do
#need to mock the solr response so we dont depend on solr
	describe 'csv' do
		it 'should generate a csv from a document' do
			report=Report.new
			csv_body=report.csv
			#if the content parses ok, it is a valid csv file
			csv_body.length.should be > 0
			CSV.parse(csv_body)
		end
		it 'should double quote fields so the csv doesnt have erronious columns if the data contain columns' do
			report=Report.new
			report.stub(:docs_to_records).and_return([{"shelved_file_count"=>0, "shelved_dt"=>"", "content_type_facet"=>nil, "purl"=>"http://purl-test.stanford.edu/mj151qw9093", "file_count"=>0, "objectType_facet"=>nil, "tag_facet"=>nil, "collection_druid"=>nil, "collection"=>nil, "druid"=>"mj151qw9093", "published_dt"=>"", "barcode_id_t"=>nil, "catkey_id_t"=>nil, "source_id_t"=>nil, "preserved_dt"=>"", "registered_by_tag_facet"=>nil, "citation"=>"<em>Molecular, Mechanisms, of, Centromeric, Chromatin Assembly</em>", "title"=>"Molecular Mechanisms of Centromeric Chromatin Assembly", "errors"=>nil, "accessioned_dt"=>"", "status"=>"  ", "project_tag_facet"=>nil, "apo"=>nil, "id"=>1, "apo_druid"=>nil}, {"shelved_file_count"=>0, "shelved_dt"=>"", "content_type_facet"=>nil, "purl"=>"http://purl-test.stanford.edu/yn537jy3042", "file_count"=>0, "objectType_facet"=>nil, "tag_facet"=>nil, "collection_druid"=>nil, "collection"=>nil, "druid"=>"yn537jy3042", "published_dt"=>"", "barcode_id_t"=>nil, "catkey_id_t"=>nil, "source_id_t"=>nil, "preserved_dt"=>"", "registered_by_tag_facet"=>nil, "citation"=>"<em>Testing the Title</em>", "title"=>"Testing the Title", "errors"=>nil, "accessioned_dt"=>"", "status"=>"  ", "project_tag_facet"=>nil, "apo"=>nil, "id"=>2, "apo_druid"=>nil}, {"shelved_file_count"=>0, "shelved_dt"=>"", "content_type_facet"=>nil, "purl"=>"http://purl-test.stanford.edu/pj197kv9984", "file_count"=>0, "objectType_facet"=>nil, "tag_facet"=>nil, "collection_druid"=>nil, "collection"=>nil, "druid"=>"pj197kv9984", "published_dt"=>"", "barcode_id_t"=>nil, "catkey_id_t"=>nil, "source_id_t"=>nil, "preserved_dt"=>"", "registered_by_tag_facet"=>nil, "citation"=>"<em>Testing the Title</em>", "title"=>"Testing the Title", "errors"=>nil, "accessioned_dt"=>"", "status"=>"  ", "project_tag_facet"=>nil, "apo"=>nil, "id"=>3, "apo_druid"=>nil}, {"shelved_file_count"=>0, "shelved_dt"=>"", "content_type_facet"=>nil, "purl"=>"http://purl-test.stanford.edu/cx735nt1036", "file_count"=>0, "objectType_facet"=>nil, "tag_facet"=>nil, "collection_druid"=>nil, "collection"=>nil, "druid"=>"cx735nt1036", "published_dt"=>"", "barcode_id_t"=>nil, "catkey_id_t"=>nil, "source_id_t"=>nil, "preserved_dt"=>"", "registered_by_tag_facet"=>nil, "citation"=>"<em>Testing the Title</em>", "title"=>"Testing the Title", "errors"=>nil, "accessioned_dt"=>"", "status"=>"  ", "project_tag_facet"=>nil, "apo"=>nil, "id"=>4, "apo_druid"=>nil}, {"shelved_file_count"=>0, "shelved_dt"=>"", "content_type_facet"=>nil, "purl"=>"http://purl-test.stanford.edu/hp752fw2452", "file_count"=>0, "objectType_facet"=>nil, "tag_facet"=>nil, "collection_druid"=>nil, "collection"=>nil, "druid"=>"hp752fw2452", "published_dt"=>"", "barcode_id_t"=>nil, "catkey_id_t"=>nil, "source_id_t"=>nil, "preserved_dt"=>"", "registered_by_tag_facet"=>nil, "citation"=>"<em>Testing the Title</em>", "title"=>"Testing the Title", "errors"=>nil, "accessioned_dt"=>"", "status"=>"  ", "project_tag_facet"=>nil, "apo"=>nil, "id"=>5, "apo_druid"=>nil}, {"shelved_file_count"=>0, "shelved_dt"=>"", "content_type_facet"=>nil, "purl"=>"http://purl-test.stanford.edu/gx915ms8428", "file_count"=>0, "objectType_facet"=>nil, "tag_facet"=>nil, "collection_druid"=>nil, "collection"=>nil, "druid"=>"gx915ms8428", "published_dt"=>"", "barcode_id_t"=>nil, "catkey_id_t"=>nil, "source_id_t"=>nil, "preserved_dt"=>"", "registered_by_tag_facet"=>nil, "citation"=>"<em>Interpolation on Manifolds of CFD-Based Fluid and Finite Element-Based Structural Reduced-Order Models for On-Line Aeroelastic Predictions</em>", "title"=>"Interpolation on Manifolds of CFD-Based Fluid and Finite Element-Based Structural Reduced-Order Models for On-Line Aeroelastic Predictions", "errors"=>nil, "accessioned_dt"=>"", "status"=>"  ", "project_tag_facet"=>nil, "apo"=>nil, "id"=>6, "apo_druid"=>nil}, {"shelved_file_count"=>0, "shelved_dt"=>"", "content_type_facet"=>nil, "purl"=>"http://purl-test.stanford.edu/yy240dn4976", "file_count"=>0, "objectType_facet"=>nil, "tag_facet"=>nil, "collection_druid"=>nil, "collection"=>nil, "druid"=>"yy240dn4976", "published_dt"=>"", "barcode_id_t"=>nil, "catkey_id_t"=>nil, "source_id_t"=>nil, "preserved_dt"=>"", "registered_by_tag_facet"=>nil, "citation"=>"<em>Life History and Livelihood Strategies in the Colombian Choco</em>", "title"=>"Life History and Livelihood Strategies in the Colombian Choco", "errors"=>nil, "accessioned_dt"=>"", "status"=>"  ", "project_tag_facet"=>nil, "apo"=>nil, "id"=>7, "apo_druid"=>nil}, {"shelved_file_count"=>0, "shelved_dt"=>"", "content_type_facet"=>nil, "purl"=>"http://purl-test.stanford.edu/ms600hb1411", "file_count"=>0, "objectType_facet"=>nil, "tag_facet"=>nil, "collection_druid"=>nil, "collection"=>nil, "druid"=>"ms600hb1411", "published_dt"=>"", "barcode_id_t"=>nil, "catkey_id_t"=>nil, "source_id_t"=>nil, "preserved_dt"=>"", "registered_by_tag_facet"=>nil, "citation"=>"<em>This is a test of both Apply to Graduate as well as e-dissertation (missing Ediss). We are trying to recreate the missing e-diss problem</em>", "title"=>"This is a test of both Apply to Graduate as well as e-dissertation (missing Ediss). We are trying to recreate the missing e-diss problem", "errors"=>nil, "accessioned_dt"=>"", "status"=>"  ", "project_tag_facet"=>nil, "apo"=>nil, "id"=>8, "apo_druid"=>nil}, {"shelved_file_count"=>0, "shelved_dt"=>"", "content_type_facet"=>nil, "purl"=>"http://purl-test.stanford.edu/kc223xd3815", "file_count"=>0, "objectType_facet"=>nil, "tag_facet"=>nil, "collection_druid"=>nil, "collection"=>nil, "druid"=>"kc223xd3815", "published_dt"=>"", "barcode_id_t"=>nil, "catkey_id_t"=>nil, "source_id_t"=>nil, "preserved_dt"=>"", "registered_by_tag_facet"=>nil, "citation"=>"<em>Performance Analysis and Optimization of Wireless Mesh Networks</em>", "title"=>"Performance Analysis and Optimization of Wireless Mesh Networks", "errors"=>nil, "accessioned_dt"=>"", "status"=>"  ", "project_tag_facet"=>nil, "apo"=>nil, "id"=>9, "apo_druid"=>nil}, {"shelved_file_count"=>0, "shelved_dt"=>"", "content_type_facet"=>nil, "purl"=>"http://purl-test.stanford.edu/gp555bc3551", "file_count"=>0, "objectType_facet"=>nil, "tag_facet"=>nil, "collection_druid"=>nil, "collection"=>nil, "druid"=>"gp555bc3551", "published_dt"=>"", "barcode_id_t"=>nil, "catkey_id_t"=>nil, "source_id_t"=>nil, "preserved_dt"=>"", "registered_by_tag_facet"=>nil, "citation"=>"<em>TEST BY SIBI</em>", "title"=>"TEST BY SIBI", "errors"=>nil, "accessioned_dt"=>"", "status"=>"  ", "project_tag_facet"=>nil, "apo"=>nil, "id"=>10, "apo_druid"=>nil}])
			csv_body=report.csv
			csv_body.should match "\"<em>Molecular, Mechanisms, of, "
		end
	end
end