<% if object.datastreams.keys.include?('contentMetadata') and not object.datastreams['contentMetadata'].new? %>
<% content_ds = object.datastreams['contentMetadata'] %>
<div style="clear:left">
  <ul class="resource-tree">
    <li>
      <span class="label">Type</span>
      <%= content_ds.ng_xml.root['type']%>
      <ul>
        <% content_ds.ng_xml.xpath('/contentMetadata/resource').each_with_index do |resource,index| %>
          <li class="resource">
            <span class="label">Resource (<%=index+1%>)</span>
            <%= resource['id'] %>
            <% if resource.at('label') %>
              (<%= resource.at('label').text %>)
            <% end %>
            <ul>
              <% resource.xpath('file').each do |file| %>
                <li class="file">
                  <span class="label">File</span>
                  <%= file['id'] %> 
                  (<%= file['format'] %>, <%= file['mimetype'] %>, <%= file['size'].to_i.bytestring('%.1f%s') %>,
                  <%= ['publish','shelve','preserve'].reject { |a| file[a] != 'yes' }.join('/') %>)
                </li>
              <% end %>
            </ul>
          </li>
        <% end %>
      </ul>
    </li>
</div>
<% end %>